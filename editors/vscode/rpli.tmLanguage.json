{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "RPL Interface",
  "scopeName": "source.rpli",
  "patterns": [
    { "include": "#comments" },
    { "include": "#library-header" },
    { "include": "#declaration" }
  ],
  "repository": {
    "comments": {
      "patterns": [
        {
          "name": "comment.line.double-dash.rpli",
          "match": "--.*$"
        },
        {
          "name": "comment.line.double-slash.rpli",
          "match": "//.*$"
        }
      ]
    },
    "library-header": {
      "match": "^\\s*(library)\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+([0-9]+)",
      "captures": {
        "1": { "name": "keyword.control.library.rpli" },
        "2": { "name": "entity.name.type.library.rpli" },
        "3": { "name": "constant.numeric.id.rpli" }
      }
    },
    "declaration": {
      "patterns": [
        { "include": "#command-id" },
        { "include": "#arrow" },
        { "include": "#types" },
        { "include": "#command-name" },
        { "include": "#binding" },
        { "include": "#slot" },
        { "include": "#keywords" },
        { "include": "#operators" }
      ]
    },
    "command-id": {
      "match": "^\\s*([0-9]+)\\s*:",
      "captures": {
        "1": { "name": "constant.numeric.command-id.rpli" }
      }
    },
    "arrow": {
      "name": "keyword.operator.arrow.rpli",
      "match": "->"
    },
    "types": {
      "name": "storage.type.rpli",
      "match": "\\b(Int|Real|Str|Prog|Sym|List|Bytes|Plot|Numeric|Any)\\b"
    },
    "command-name": {
      "name": "entity.name.function.command.rpli",
      "match": "\\b[A-Z][A-Z0-9]*\\b"
    },
    "binding": {
      "match": "(\\$)([a-zA-Z_][a-zA-Z0-9_]*)(:)([a-zA-Z]+)",
      "captures": {
        "1": { "name": "punctuation.definition.binding.rpli" },
        "2": { "name": "variable.parameter.binding.rpli" },
        "3": { "name": "punctuation.separator.rpli" },
        "4": { "name": "storage.type.rpli" }
      }
    },
    "slot": {
      "match": "\\b([a-z_][a-zA-Z0-9_]*)(:)([a-zA-Z]+)",
      "captures": {
        "1": { "name": "variable.parameter.slot.rpli" },
        "2": { "name": "punctuation.separator.rpli" },
        "3": { "name": "storage.type.rpli" }
      }
    },
    "keywords": {
      "patterns": [
        {
          "name": "keyword.control.rpli",
          "match": "\\b(THEN|ELSE|END|NEXT|STEP|REPEAT|UNTIL|DEFAULT|THENERR|ELSEERR|ENDERR)\\b"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.optional.rpli",
          "match": "[?!*|]"
        },
        {
          "name": "punctuation.bracket.rpli",
          "match": "[()\\[\\]]"
        }
      ]
    }
  }
}
